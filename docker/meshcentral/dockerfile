FROM node:stretch

WORKDIR /home/node/app
ARG MESH_HOST
ARG MONGODB_USER
ARG MONGODB_PASSWORD
RUN apt-get update && apt-get install -y gettext-base
RUN npm install meshcentral
COPY config.json ./meshcentral-data/config.json.tmp
RUN envsubst '\$MESH_HOST, \$MONGODB_USER, \$MONGODB_PASSWORD' < /home/node/app/meshcentral-data/config.json.tmp > /home/node/app/meshcentral-data/config.json && \
    rm /home/node/app/meshcentral-data/config.json.tmp

CMD ["node", "./node_modules/meshcentral/meshcentral"]